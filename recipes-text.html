<!doctype html>
<html class="no-js" lang="zh-CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="Artifex" name="author" />
<meta content="PyMuPDF 是一个高性能 Python 库，用于 PDF（及其他）文档的数据提取、分析、转换和操作。" name="description" />
<meta content="PDF Text Extraction, PDF Image Extraction, PDF Conversion, PDF Tables, PDF Splitting, PDF Creation, Pyodide, PyScript" name="keywords" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZTN4VTL9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JZTN4VTL9M');
    </script>
    <link rel="author" title="关于此文档" href="about.html" /><link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="图片" href="recipes-images.html" /><link rel="prev" title="打开文件" href="how-to-open-a-file.html" />

    <link rel="shortcut icon" href="_static/PyMuPDF.ico"/><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>文本 - PyMuPDF 1.25.4 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">PyMuPDF 1.25.4 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/sidebar-logo-dark.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/sidebar-logo-light.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PyMuPDF 1.25.4 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">关于/About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">功能比较</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#about-performance">性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#about-license">许可和版权</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf4llm/index.html">PyMuPDF4LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf-pro.html">PyMuPDF Pro</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户指南/User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="the-basics.html">基础用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag.html">PyMuPDF、LLM 和 RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">资源</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">教程/How to Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="how-to-open-a-file.html">打开文件</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">文本</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-images.html">图片</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-annotations.html">注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-drawing-and-graphics.html">绘图和图形</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-stories.html">故事</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-journalling.html">日记</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-multiprocessing.html">多进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-ocr.html">OCR - 光学字符识别</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-optional-content.html">可选内容支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-low-level-interfaces.html">低级接口</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-common-issues-and-their-solutions.html">常见问题及其解决方案</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考/API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module.html">命令行界面</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="classes.html">类</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="annot.html">Annot</a></li>
<li class="toctree-l2"><a class="reference internal" href="archive-class.html">Archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="colorspace.html">Colorspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="displaylist.html">DisplayList</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="document-writer-class.html">DocumentWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="font.html">Font</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity.html">Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="irect.html">IRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="link.html">Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="linkdest.html">linkDest</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrix.html">Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="outline.html">Outline</a></li>
<li class="toctree-l2"><a class="reference internal" href="page.html">Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="pixmap.html">Pixmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="point.html">Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="quad.html">Quad</a></li>
<li class="toctree-l2"><a class="reference internal" href="rect.html">Rect</a></li>
<li class="toctree-l2"><a class="reference internal" href="shape.html">Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="story-class.html">Story</a></li>
<li class="toctree-l2"><a class="reference internal" href="textpage.html">TextPage</a></li>
<li class="toctree-l2"><a class="reference internal" href="textwriter.html">TextWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="widget.html">Widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml-class.html">Xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="algebra.html">几何对象的运算符代数</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="lowlevel.html">低级函数和类</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="functions.html">函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="device.html">设备</a></li>
<li class="toctree-l2"><a class="reference internal" href="coop_low.html">协同工作: DisplayList 和 TextPage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="vars.html">常量和枚举</a></li>
<li class="toctree-l1"><a class="reference internal" href="colors.html">颜色数据库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他/Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="app1.html">附录 1：文本提取详细信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="app2.html">附录 2：嵌入式文件的注意事项</a></li>
<li class="toctree-l1"><a class="reference internal" href="app3.html">附录 3：各类技术信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="app4.html">附录 4：性能比较方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">更新日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="znames.html">已废弃名称</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div style="display:flex;justify-content:space-between;align-items: center;">
    <form class="sidebar-search-container top" method="get" action="search.html" role="search" style="width:75%">
      <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
</div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-top:20px;">
    <div class="discordLink" style="display:flex;align-items:center;margin-top: -5px;">
        <a href="https://discord.gg/TSpYGBW4eq" id="findOnDiscord" target=_blank>Find <b>#pymupdf</b> on <b>Discord</b></a>
        <a href="https://discord.gg/TSpYGBW4eq" target=_blank>
            <div style="width:30px;height:30px;margin-left:5px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
                    <defs>
                        <style>.discordLogoFill{fill:#5865f2;}</style>
                    </defs>
                    <g id="Discord_Logo" data-name="Discord Logo">
                        <path class="discordLogoFill" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </g>
                </svg>
            </div>
        </a>
    </div>

</div><section id="recipestext">
<span id="id1"></span><h1>文本<a class="headerlink" href="#recipestext" title="此标题的永久链接">#</a></h1>
<p>Text</p>
<section id="recipestext-a">
<span id="id2"></span><h2>如何提取所有文档文本<a class="headerlink" href="#recipestext-a" title="此标题的永久链接">#</a></h2>
<p>How to Extract all Document Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>此脚本将获取一个文档文件名，并从其所有文本中生成一个文本文件。</p>
<p>该文档可以是任何 <a class="reference internal" href="how-to-open-a-file.html#supported-file-types"><span class="std std-ref">受支持的类型</span></a>。</p>
<p>该脚本作为一个命令行工具运行，期望将文档文件名作为参数提供。它将在脚本目录中生成一个名为 <code class="xref any docutils literal notranslate"><span class="pre">&quot;filename.txt&quot;</span></code> 的文本文件。页面文本之间使用换页符分隔:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">pathlib</span><span class="o">,</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 获取文档文件名</span>
<span class="k">with</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">doc</span><span class="p">:</span>  <span class="c1"># 打开文档</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">])</span>
<span class="c1"># 以二进制文件写入，以支持非 ASCII 字符</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</pre></div>
</div>
<p>输出将保持文档中的纯文本编码格式，不会进行美化处理。特别是对于 PDF，这可能意味着输出的文本顺序可能不是通常的阅读顺序，可能会出现意外的换行等问题。</p>
<p>您有多种方法可以修正这些问题 —— 请参阅 <a class="reference internal" href="app2.html#appendix2"><span class="std std-ref">附录 2</span></a>。其中包括：</p>
<ol class="arabic simple">
<li><p>以 HTML 格式提取文本，并将其存储为 HTML 文档，以便在任何浏览器中查看。</p></li>
<li><p>通过 <em>Page.get_text(“blocks”)</em> 提取文本块列表。该列表的每个项目都包含文本的位置信息，可用于建立合理的阅读顺序。</p></li>
<li><p>通过 <em>Page.get_text(“words”)</em> 提取单词列表。其项目包含单词及其位置信息，可用于确定给定矩形区域内的文本 —— 请参阅下一节。</p></li>
</ol>
<p>请参阅接下来的两个部分，以获取示例和进一步的说明。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>This script will take a document filename and generate a text file from all of its text.</p>
<p>The document can be any <a class="reference internal" href="how-to-open-a-file.html#supported-file-types"><span class="std std-ref">supported type</span></a>.</p>
<p>The script works as a command line tool which expects the document filename supplied as a parameter. It generates one text file named “filename.txt” in the script directory. Text of pages is separated by a form feed character:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">pathlib</span><span class="o">,</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># get document filename</span>
<span class="k">with</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">doc</span><span class="p">:</span>  <span class="c1"># open document</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">])</span>
<span class="c1"># write as a binary file to support non-ASCII characters</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</pre></div>
</div>
<p>The output will be plain text as it is coded in the document. No effort is made to prettify in any way. Specifically for PDF, this may mean output not in usual reading order, unexpected line breaks and so forth.</p>
<p>You have many options to rectify this – see chapter <a class="reference internal" href="app2.html#appendix2"><span class="std std-ref">附录 2：嵌入式文件的注意事项</span></a>. Among them are:</p>
<ol class="arabic simple">
<li><p>Extract text in HTML format and store it as a HTML document, so it can be viewed in any browser.</p></li>
<li><p>Extract text as a list of text blocks via <em>Page.get_text(“blocks”)</em>. Each item of this list contains position information for its text, which can be used to establish a convenient reading order.</p></li>
<li><p>Extract a list of single words via <em>Page.get_text(“words”)</em>. Its items are words with position information. Use it to determine text contained in a given rectangle – see next section.</p></li>
</ol>
<p>See the following two sections for examples and further explanations.</p>
</div>
</div>
</section>
<section id="markdown">
<span id="index-0"></span><h2>如何将文本提取为 Markdown<a class="headerlink" href="#markdown" title="此标题的永久链接">#</a></h2>
<p>How to Extract Text as Markdown</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>这对于:title:<code class="xref any docutils literal notranslate"><span class="pre">RAG/LLM</span></code> 环境特别有用 - 请参阅:ref:<a class="reference internal" href="rag.html#rag-outputting-as-md"><span class="std std-ref">输出为 Markdown</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>This is especially useful for <cite>RAG/LLM</cite> environments - please see <a class="reference internal" href="rag.html#rag-outputting-as-md"><span class="std std-ref">Outputting as Markdown</span></a>.</p>
</div>
</div>
</section>
<section id="recipestext-a1">
<span id="id3"></span><h2>如何从页面中提取键值对<a class="headerlink" href="#recipestext-a1" title="此标题的永久链接">#</a></h2>
<p>How to Extract Key-Value Pairs from a Page</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>如果页面的布局在某种程度上是 <em>“可预测的”</em>，那么可以使用一种简单的方法快速、轻松地查找给定关键字对应的值 —— 而无需使用正则表达式。请参阅 <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/text-extraction/lookup-keywords.py">此示例脚本</a>。</p>
<p>在此上下文中，“可预测”意味着：</p>
<ul class="simple">
<li><p>每个关键字后面紧跟其对应的值 —— 它们之间没有其他文本。</p></li>
<li><p>该值的边界框底部 <strong>不会高于</strong> 关键字的底部。</p></li>
<li><p><strong>没有其他限制</strong>：页面布局可以是固定的，也可以是非固定的，文本也可能存储为一个整体字符串。关键字和值之间可以有任意距离。</p></li>
</ul>
<p>例如，以下五组键值对都可以被正确识别:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key1</span>               <span class="n">value1</span>
<span class="n">key2</span>
<span class="n">value2</span>
<span class="n">key3</span>
       <span class="n">value3</span> <span class="n">blah</span><span class="p">,</span> <span class="n">blah</span><span class="p">,</span> <span class="n">blah</span> <span class="n">key4</span> <span class="n">value4</span> <span class="n">some</span> <span class="n">other</span> <span class="n">text</span> <span class="n">key5</span> <span class="n">value5</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>If the layout of a page is <em>“predictable”</em> in some sense, then there is a simple way to find the values for a given set of keywords fast and easily – without using regular expressions. Please see <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/text-extraction/lookup-keywords.py">this example script</a>.</p>
<p>“Predictable” in this context means:</p>
<ul class="simple">
<li><p>Every keyword is followed by its value – no other text is present in between them.</p></li>
<li><p>The bottom of the value’s boundary box is <strong>not above</strong> the one of the keyword.</p></li>
<li><p>There are <strong>no other restrictions</strong>: the page layout may or may not be fixed, and the text may also have been stored as one string. Key and value may have any distance from each other.</p></li>
</ul>
<p>For example, the following five key-value pairs will be correctly identified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key1</span>               <span class="n">value1</span>
<span class="n">key2</span>
<span class="n">value2</span>
<span class="n">key3</span>
       <span class="n">value3</span> <span class="n">blah</span><span class="p">,</span> <span class="n">blah</span><span class="p">,</span> <span class="n">blah</span> <span class="n">key4</span> <span class="n">value4</span> <span class="n">some</span> <span class="n">other</span> <span class="n">text</span> <span class="n">key5</span> <span class="n">value5</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="recipestext-b">
<span id="index-1"></span><span id="id5"></span><h2>如何从矩形内提取文本<a class="headerlink" href="#recipestext-b" title="此标题的永久链接">#</a></h2>
<p>How to Extract Text from within a Rectangle</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>现在 (v1.18.0) 有多种方法可以实现此目的。因此，我们在 PyMuPDF-Utilities 存储库中创建了一个 <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/textbox-extraction">文件夹</a> 专门处理此主题。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>There is now (v1.18.0) more than one way to achieve this. We therefore have created a <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/textbox-extraction">folder</a> in the PyMuPDF-Utilities repository specifically dealing with this topic.</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="recipestext-c">
<span id="index-2"></span><span id="id7"></span><h2>如何按自然阅读顺序提取文本<a class="headerlink" href="#recipestext-c" title="此标题的永久链接">#</a></h2>
<p>How to Extract Text in Natural Reading Order</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>PDF 文本提取的一个常见问题是，提取出的文本可能没有特定的阅读顺序。</p>
<p>这取决于 PDF 创建者（软件或人工）。例如，页眉可能是在文档生成后另行插入的。在这种情况下，页眉文本在提取时会出现在页面文本的末尾（尽管 PDF 查看器会正确显示它）。例如，以下代码片段将在现有 PDF 上添加一些页眉和页脚:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;some.pdf&quot;</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;Header&quot;</span>  <span class="c1"># 页眉文本</span>
<span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;Page </span><span class="si">%i</span><span class="s2"> of </span><span class="si">%i</span><span class="s2">&quot;</span>  <span class="c1"># 页脚文本</span>
<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
    <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">header</span><span class="p">)</span>  <span class="c1"># 插入页眉</span>
    <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span>  <span class="c1"># 在页面底部上方 50 点插入页脚</span>
        <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">footer</span> <span class="o">%</span> <span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>经过这种修改的页面，在提取文本时的顺序可能如下：</p>
<ol class="arabic simple">
<li><p>原始文本</p></li>
<li><p>页眉</p></li>
<li><p>页脚</p></li>
</ol>
<p><cite>PyMuPDF</cite> 提供了几种方法来恢复阅读顺序，甚至重新生成接近原始布局的文本：</p>
<ol class="arabic simple">
<li><p>使用 <a class="reference internal" href="page.html#Page.get_text" title="Page.get_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.get_text()</span></code></a> 方法的 <code class="xref any docutils literal notranslate"><span class="pre">sort</span></code> 参数。该参数会将输出按照从左上角到右下角的顺序排序（对于 XHTML、HTML 和 XML 输出无效）。</p></li>
<li><p>使用 <cite>PyMuPDF</cite> 的命令行工具：<code class="xref any docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pymupdf</span> <span class="pre">gettext</span> <span class="pre">...</span></code>，该工具会生成一个文本文件，并在保留布局的模式下重新排列文本。可以使用多个选项来自定义输出格式。</p></li>
</ol>
<p>此外，你还可以根据需要修改 <a class="reference external" href="https://github.com/pymupdf/PyMuPDF/wiki/How-to-extract-text-from-a-rectangle">此脚本</a> 来适应不同的需求。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>One of the common issues with PDF text extraction is, that text may not appear in any particular reading order.</p>
<p>This is the responsibility of the PDF creator (software or a human). For example, page headers may have been inserted in a separate step – after the document had been produced. In such a case, the header text will appear at the end of a page text extraction (although it will be correctly shown by PDF viewer software). For example, the following snippet will add some header and footer lines to an existing PDF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;some.pdf&quot;</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;Header&quot;</span>  <span class="c1"># text in header</span>
<span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;Page </span><span class="si">%i</span><span class="s2"> of </span><span class="si">%i</span><span class="s2">&quot;</span>  <span class="c1"># text in footer</span>
<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
    <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">header</span><span class="p">)</span>  <span class="c1"># insert header</span>
    <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span>  <span class="c1"># insert footer 50 points above page bottom</span>
        <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">footer</span> <span class="o">%</span> <span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The text sequence extracted from a page modified in this way will look like this:</p>
<ol class="arabic simple">
<li><p>original text</p></li>
<li><p>header line</p></li>
<li><p>footer line</p></li>
</ol>
<p>PyMuPDF has several means to re-establish some reading sequence or even to re-generate a layout close to the original:</p>
<ol class="arabic simple">
<li><p>Use <code class="xref any docutils literal notranslate"><span class="pre">sort</span></code> parameter of <a class="reference internal" href="page.html#Page.get_text" title="Page.get_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.get_text()</span></code></a>. It will sort the output from top-left to bottom-right (ignored for XHTML, HTML and XML output).</p></li>
<li><p>Use the <code class="xref any docutils literal notranslate"><span class="pre">pymupdf</span></code> module in CLI: <code class="xref any docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pymupdf</span> <span class="pre">gettext</span> <span class="pre">...</span></code>, which produces a text file where text has been re-arranged in layout-preserving mode. Many options are available to control the output.</p></li>
</ol>
<p>You can also use the above mentioned <a class="reference external" href="https://github.com/pymupdf/PyMuPDF/wiki/How-to-extract-text-from-a-rectangle">script</a> with your modifications.</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="recipestext-d">
<span id="id9"></span><h2>如何从文档中 <span class="target" id="index-3"></span>提取表格内容<a class="headerlink" href="#recipestext-d" title="此标题的永久链接">#</a></h2>
<p>How to <span class="target" id="index-4"></span>Extract Table Content from Documents</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>如果你在文档中看到一张表格，通常它并不是嵌入的 Excel 文件或其他可识别的对象，而只是普通文本，经过格式化后呈现为表格数据的样式。</p>
<p>因此，从这样的页面区域提取表格数据意味着你必须找到一种方法来 <strong>识别</strong> 表格区域（即其边界框），然后执行以下步骤：</p>
<ol class="arabic simple">
<li><p><strong>(1)</strong> 以图形方式标识表格及其列边界；</p></li>
<li><p><strong>(2)</strong> 基于这些信息提取文本。</p></li>
</ol>
<p>根据具体情况，例如表格是否包含线条、矩形或其他辅助矢量图形，这可能是一项非常复杂的任务。</p>
<p><a class="reference internal" href="page.html#Page.find_tables" title="Page.find_tables"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.find_tables()</span></code></a> 方法可以自动完成上述步骤，并具有较高的表格检测精度。其主要优点包括：</p>
<ul class="simple">
<li><p><strong>无需依赖外部库</strong>，避免了额外的安装和兼容性问题。</p></li>
<li><p><strong>无需使用人工智能或机器学习技术</strong>，提升了可用性和执行效率。</p></li>
<li><p><strong>内置支持</strong> <a class="reference external" href="https://pypi.org/project/pandas/">pandas</a>，可方便地将表格数据转换为 Pandas 数据框进行分析。</p></li>
</ul>
<p>你可以参考 <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/table-analysis">Jupyter Notebook 示例</a>，其中涵盖了多种标准情况，如：</p>
<ul class="simple">
<li><p>同一页上包含多个表格；</p></li>
<li><p>将跨页的表格片段合并为完整表格。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>If you see a table in a document, you are normally not looking at something like an embedded Excel or other identifiable object. It usually is just normal, standard text, formatted to appear as tabular data.</p>
<p>Extracting tabular data from such a page area therefore means that you must find a way to <strong>identify</strong> the table area (i.e. its boundary box), then <strong>(1)</strong> graphically indicate table and column borders, and <strong>(2)</strong> then extract text based on this information.</p>
<p>This can be a very complex task, depending on details like the presence or absence of lines, rectangles or other supporting vector graphics.</p>
<p>Method <a class="reference internal" href="page.html#Page.find_tables" title="Page.find_tables"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.find_tables()</span></code></a> does all that for you, with a high table detection precision. Its great advantage is that there are no external library dependencies, nor the need to employ artificial intelligence or machine learning technologies. It also provides an integrated interface to the well-known Python package for data analysis <a class="reference external" href="https://pypi.org/project/pandas/">pandas</a>.</p>
<p>Please have a look at example <a class="reference external" href="https://github.com/pymupdf/PyMuPDF-Utilities/tree/master/table-analysis">Jupyter notebooks</a>, which cover standard situations like multiple tables on one page or joining table fragments across multiple pages.</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="recipestext-e">
<span id="id11"></span><h2>如何标记提取的文本<a class="headerlink" href="#recipestext-e" title="此标题的永久链接">#</a></h2>
<p>How to Mark Extracted Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p><cite>PyMuPDF</cite> 提供了一个标准的搜索功能，可用于在页面上搜索任意文本：<a class="reference internal" href="page.html#Page.search_for" title="Page.search_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.search_for()</span></code></a>。该方法返回一个 <a class="reference internal" href="rect.html#rect"><span class="std std-ref">Rect</span></a> 对象列表，每个矩形对象包围着匹配文本的区域。这些矩形可以用于自动插入批注，从而可视化地标记找到的文本。</p>
<p>该方法的优缺点如下：</p>
<p><strong>优点：</strong>
- 搜索字符串可以包含空格，并且可以跨行匹配
- 不区分大小写
- 可以检测并解析行尾的单词连字符（hyphenation）
- 返回值还可以是 <a class="reference internal" href="quad.html#quad"><span class="std std-ref">Quad</span></a> 对象列表，以精确定位 <strong>非水平或非垂直</strong> 的文本
- 如果页面已旋转，建议使用 <a class="reference internal" href="quad.html#quad"><span class="std std-ref">Quad</span></a> 以获得准确的位置</p>
<p><strong>然而，你也可以使用其他方法，例如以下代码：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mark_word</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;为包含 &#39;text&#39; 的每个单词添加下划线标注&quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wlist</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># 获取单词列表</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wlist</span><span class="p">:</span>  <span class="c1"># 遍历页面上的所有单词</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>  <span class="c1"># w[4] 是单词的文本内容</span>
            <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">w</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># 从单词边界框创建矩形</span>
            <span class="n">page</span><span class="o">.</span><span class="n">add_underline_annot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>  <span class="c1"># 添加下划线标注</span>
    <span class="k">return</span> <span class="n">found</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 文件名</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># 搜索字符串</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;在文档 &#39;</span><span class="si">%s</span><span class="s2">&#39; 中查找并标注包含 &#39;</span><span class="si">%s</span><span class="s2">&#39; 的单词&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>

<span class="n">new_doc</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 指示是否有匹配项</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>  <span class="c1"># 遍历所有页面</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">mark_word</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># 标注页面中的匹配单词</span>
    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>  <span class="c1"># 如果找到匹配项</span>
        <span class="n">new_doc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;在第 </span><span class="si">%i</span><span class="s2"> 页找到 &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%i</span><span class="s2"> 次&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">found</span><span class="p">))</span>

<span class="k">if</span> <span class="n">new_doc</span><span class="p">:</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;marked-&quot;</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>该脚本使用 <code class="xref any docutils literal notranslate"><span class="pre">Page.get_text(&quot;words&quot;)</span></code> 方法，通过 CLI 参数提供的字符串进行搜索。它将页面文本按空格分割为单词，并按单词进行搜索。以下是一些注意事项：</p>
<ul class="simple">
<li><p><strong>如果找到匹配项，则标注整个包含该字符串的单词</strong> （添加下划线），而不仅仅是匹配部分。</p></li>
<li><p><strong>搜索字符串不能包含单词分隔符</strong>，默认的分隔符是空格和不间断空格 <code class="xref any docutils literal notranslate"><span class="pre">chr(0xA0)</span></code>。如果使用了额外的分隔符（例如 <code class="xref any docutils literal notranslate"><span class="pre">page.get_text(&quot;words&quot;,</span> <span class="pre">delimiters=&quot;./,&quot;)</span></code>），那么搜索字符串中也不能包含这些字符。</p></li>
<li><p><strong>区分大小写</strong>，但可以在 <em>mark_word</em> 方法中使用 <em>lower()</em> 方法或正则表达式来忽略大小写。</p></li>
<li><p><strong>没有上限</strong>，所有出现的匹配项都会被检测到。</p></li>
<li><p><strong>可以使用不同的标注方式</strong>，例如：’Underline’（下划线）、’Highlight’（高亮）、’StrikeThrough’（删除线）或 ‘Square’（矩形）等。</p></li>
<li><p>以下示例展示了如何搜索 “MuPDF”，并且所有包含 “MuPDF” 的完整单词都被下划线标注，而不仅仅是 “MuPDF” 本身。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>There is a standard search function to search for arbitrary text on a page: <a class="reference internal" href="page.html#Page.search_for" title="Page.search_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.search_for()</span></code></a>. It returns a list of <a class="reference internal" href="rect.html#rect"><span class="std std-ref">Rect</span></a> objects which surround a found occurrence. These rectangles can for example be used to automatically insert annotations which visibly mark the found text.</p>
<p>This method has advantages and drawbacks. Pros are:</p>
<ul class="simple">
<li><p>The search string can contain blanks and wrap across lines</p></li>
<li><p>Upper or lower case characters are treated equal</p></li>
<li><p>Word hyphenation at line ends is detected and resolved</p></li>
<li><p>Return may also be a list of <a class="reference internal" href="quad.html#quad"><span class="std std-ref">Quad</span></a> objects to precisely locate text that is <strong>not parallel</strong> to either axis – using <a class="reference internal" href="quad.html#quad"><span class="std std-ref">Quad</span></a> output is also recommended, when page rotation is not zero.</p></li>
</ul>
<p>But you also have other options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mark_word</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Underline each word that contains &#39;text&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wlist</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># make the word list</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wlist</span><span class="p">:</span>  <span class="c1"># scan through all words on page</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>  <span class="c1"># w[4] is the word&#39;s string</span>
            <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># count</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">w</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># make rect from word bbox</span>
            <span class="n">page</span><span class="o">.</span><span class="n">add_underline_annot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>  <span class="c1"># underline</span>
    <span class="k">return</span> <span class="n">found</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># filename</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># search string</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;underlining words containing &#39;</span><span class="si">%s</span><span class="s2">&#39; in document &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="n">new_doc</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># indicator if anything found at all</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>  <span class="c1"># scan through the pages</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">mark_word</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># mark the page&#39;s words</span>
    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>  <span class="c1"># if anything found ...</span>
        <span class="n">new_doc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found &#39;</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">%i</span><span class="s2"> times on page </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">if</span> <span class="n">new_doc</span><span class="p">:</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;marked-&quot;</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>This script uses <code class="xref any docutils literal notranslate"><span class="pre">Page.get_text(&quot;words&quot;)</span></code> to look for a string, handed in via cli parameter. This method separates a page’s text into “words” using white spaces as delimiters. Further remarks:</p>
<ul class="simple">
<li><p>If found, the <strong>complete word containing the string</strong> is marked (underlined) – not only the search string.</p></li>
<li><p>The search string may <strong>not contain word delimiters</strong>. By default, word delimiters are white spaces and the non-breaking space <code class="xref any docutils literal notranslate"><span class="pre">chr(0xA0)</span></code>. If you use extra delimiting characters like <code class="xref any docutils literal notranslate"><span class="pre">page.get_text(&quot;words&quot;,</span> <span class="pre">delimiters=&quot;./,&quot;)</span></code> then none of these characters should be included in your search string either.</p></li>
<li><p>As shown here, upper / lower cases are <strong>respected</strong>. But this can be changed by using the string method <em>lower()</em> (or even regular expressions) in function <em>mark_word</em>.</p></li>
<li><p>There is <strong>no upper limit</strong>: all occurrences will be detected.</p></li>
<li><p>You can use <strong>anything</strong> to mark the word: ‘Underline’, ‘Highlight’, ‘StrikeThrough’ or ‘Square’ annotations, etc.</p></li>
<li><p>Here is an example snippet of a page of this manual, where “MuPDF” has been used as the search string. Note that all strings <strong>containing “MuPDF”</strong> have been completely underlined (not just the search string).</p></li>
</ul>
</div>
</div>
<a class="reference internal image-reference" href="_images/img-markedpdf.jpg"><img alt="_images/img-markedpdf.jpg" src="_images/img-markedpdf.jpg" style="width: 439.2px; height: 219.6px;" /></a>
<hr class="docutils" />
</section>
<section id="recipestext-f">
<span id="id12"></span><h2>如何标记搜索到的文本<a class="headerlink" href="#recipestext-f" title="此标题的永久链接">#</a></h2>
<p>How to Mark Searched Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>此脚本用于搜索文本并对其进行标注:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># 要标注的文档</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tilted-text.pdf&quot;</span><span class="p">)</span>

<span class="c1"># 需要标记的文本</span>
<span class="n">needle</span> <span class="o">=</span> <span class="s2">&quot;¡La práctica hace el campeón!&quot;</span>

<span class="c1"># 仅处理第一页</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># 获取文本位置列表</span>
<span class="c1"># 使用 &quot;quads&quot; 而不是矩形，因为文本可能是倾斜的！</span>
<span class="n">rl</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 使用一个批注标记所有找到的文本区域</span>
<span class="n">page</span><span class="o">.</span><span class="n">add_squiggly_annot</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span>

<span class="c1"># 保存为新的 PDF 文件</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;a-squiggly.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>生成的结果如下：</p>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>This script searches for text and marks it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># the document to annotate</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tilted-text.pdf&quot;</span><span class="p">)</span>

<span class="c1"># the text to be marked</span>
<span class="n">needle</span> <span class="o">=</span> <span class="s2">&quot;¡La práctica hace el campeón!&quot;</span>

<span class="c1"># work with first page only</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># get list of text locations</span>
<span class="c1"># we use &quot;quads&quot;, not rectangles because text may be tilted!</span>
<span class="n">rl</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">search_for</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># mark all found quads with one annotation</span>
<span class="n">page</span><span class="o">.</span><span class="n">add_squiggly_annot</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span>

<span class="c1"># save to a new PDF</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;a-squiggly.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The result looks like this:</p>
</div>
</div>
<a class="reference internal image-reference" href="_images/img-textmarker.jpg"><img alt="_images/img-textmarker.jpg" src="_images/img-textmarker.jpg" style="width: 234.4px; height: 273.6px;" /></a>
<hr class="docutils" />
</section>
<section id="recipestext-g">
<span id="id13"></span><h2>如何标记非水平文本<a class="headerlink" href="#recipestext-g" title="此标题的永久链接">#</a></h2>
<p>How to Mark Non-horizontal Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>上一节已经展示了一个通过文本 <strong>搜索</strong> 检测并标记非水平文本的示例。</p>
<p>但是，使用 <a class="reference internal" href="page.html#Page.get_text" title="Page.get_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.get_text()</span></code></a> 方法的 “dict” / “rawdict” 选项进行文本 <strong>提取</strong> 时，也可能会返回相对于 x 轴具有非零角度的文本。这由行字典的 <code class="xref any docutils literal notranslate"><span class="pre">&quot;dir&quot;</span></code> 键的值指示：它是该角度的 <code class="xref any docutils literal notranslate"><span class="pre">(cosine,</span> <span class="pre">sine)</span></code> 元组。如果 <code class="xref any docutils literal notranslate"><span class="pre">line[&quot;dir&quot;]</span> <span class="pre">!=</span> <span class="pre">(1,</span> <span class="pre">0)</span></code>，则该行中所有跨度（span）的文本均按相同的非零角度旋转。</p>
<p>然而，该方法返回的 <code class="xref any docutils literal notranslate"><span class="pre">&quot;bboxes&quot;</span></code> 仍然只是矩形，而不是四边形（quads）。因此，要正确标记跨度文本，需要从行和跨度字典中恢复其四边形。可以使用以下实用函数（v1.18.9 新增）完成此操作:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">span_quad</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">recover_quad</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;dir&quot;</span><span class="p">],</span> <span class="n">span</span><span class="p">)</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">add_highlight_annot</span><span class="p">(</span><span class="n">span_quad</span><span class="p">)</span>  <span class="c1"># 这将标记整个跨度文本</span>
</pre></div>
</div>
<p>如果想要 <strong>一次性标记整行</strong> 或其中某些跨度，可使用以下代码片段（适用于 v1.18.10 及更高版本）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line_quad</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">recover_line_quad</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">spans</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;spans&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">page</span><span class="o">.</span><span class="n">add_highlight_annot</span><span class="p">(</span><span class="n">line_quad</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/img-linequad.jpg" src="_images/img-linequad.jpg" />
<p>上述 <code class="xref any docutils literal notranslate"><span class="pre">spans</span></code> 参数可以指定 <code class="xref any docutils literal notranslate"><span class="pre">line[&quot;spans&quot;]</span></code> 的任意子列表。在示例中，标记的是从第二个跨度到倒数第二个跨度的文本。如果省略该参数，则默认标记整行文本。</p>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>The previous section already shows an example for marking non-horizontal text, that was detected by text <strong>searching</strong>.</p>
<p>But text <strong>extraction</strong> with the “dict” / “rawdict” options of <a class="reference internal" href="page.html#Page.get_text" title="Page.get_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.get_text()</span></code></a> may also return text with a non-zero angle to the x-axis. This is indicated by the value of the line dictionary’s <code class="xref any docutils literal notranslate"><span class="pre">&quot;dir&quot;</span></code> key: it is the tuple <code class="xref any docutils literal notranslate"><span class="pre">(cosine,</span> <span class="pre">sine)</span></code> for that angle. If <code class="xref any docutils literal notranslate"><span class="pre">line[&quot;dir&quot;]</span> <span class="pre">!=</span> <span class="pre">(1,</span> <span class="pre">0)</span></code>, then the text of all its spans is rotated by (the same) angle != 0.</p>
<p>The “bboxes” returned by the method however are rectangles only – not quads. So, to mark span text correctly, its quad must be recovered from the data contained in the line and span dictionary. Do this with the following utility function (new in v1.18.9):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">span_quad</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">recover_quad</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;dir&quot;</span><span class="p">],</span> <span class="n">span</span><span class="p">)</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">add_highlight_annot</span><span class="p">(</span><span class="n">span_quad</span><span class="p">)</span>  <span class="c1"># this will mark the complete span text</span>
</pre></div>
</div>
<p>If you want to <strong>mark the complete line</strong> or a subset of its spans in one go, use the following snippet (works for v1.18.10 or later):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line_quad</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">recover_line_quad</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">spans</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;spans&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">page</span><span class="o">.</span><span class="n">add_highlight_annot</span><span class="p">(</span><span class="n">line_quad</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/img-linequad.jpg" src="_images/img-linequad.jpg" />
<p>The <code class="xref any docutils literal notranslate"><span class="pre">spans</span></code> argument above may specify any sub-list of <code class="xref any docutils literal notranslate"><span class="pre">line[&quot;spans&quot;]</span></code>. In the example above, the second to second-to-last span are marked. If omitted, the complete line is taken.</p>
</div>
</div>
<hr class="docutils" />
</section>
<section id="recipestext-h">
<span id="id14"></span><h2>如何分析字体特征<a class="headerlink" href="#recipestext-h" title="此标题的永久链接">#</a></h2>
<p>How to Analyze Font Characteristics</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>要分析 PDF 文本的特性，可以使用以下基础脚本作为起点：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">flags_decomposer</span><span class="p">(</span><span class="n">flags</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make font flags human readable.&quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;superscript&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;italic&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;serifed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sans&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;monospaced&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;proportional&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># read page text as a dictionary, suppressing extra spaces in CJK fonts</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">11</span><span class="p">)[</span><span class="s2">&quot;blocks&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>  <span class="c1"># iterate through the text blocks</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]:</span>  <span class="c1"># iterate through the text lines</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="s2">&quot;spans&quot;</span><span class="p">]:</span>  <span class="c1"># iterate through the text spans</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">font_properties</span> <span class="o">=</span> <span class="s2">&quot;Font: &#39;</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%s</span><span class="s2">), size </span><span class="si">%g</span><span class="s2">, color #</span><span class="si">%06x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;font&quot;</span><span class="p">],</span>  <span class="c1"># font name</span>
                <span class="n">flags_decomposer</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">]),</span>  <span class="c1"># readable font flags</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>  <span class="c1"># font size</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>  <span class="c1"># font color</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>  <span class="c1"># simple print of text</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">font_properties</span><span class="p">)</span>
</pre></div>
</div>
<p>以下是 PDF 页面及脚本的输出：</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>To analyze the characteristics of text in a PDF use this elementary script as a starting point:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">flags_decomposer</span><span class="p">(</span><span class="n">flags</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make font flags human readable.&quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;superscript&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;italic&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;serifed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sans&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;monospaced&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;proportional&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># read page text as a dictionary, suppressing extra spaces in CJK fonts</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">11</span><span class="p">)[</span><span class="s2">&quot;blocks&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>  <span class="c1"># iterate through the text blocks</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]:</span>  <span class="c1"># iterate through the text lines</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="s2">&quot;spans&quot;</span><span class="p">]:</span>  <span class="c1"># iterate through the text spans</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">font_properties</span> <span class="o">=</span> <span class="s2">&quot;Font: &#39;</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%s</span><span class="s2">), size </span><span class="si">%g</span><span class="s2">, color #</span><span class="si">%06x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;font&quot;</span><span class="p">],</span>  <span class="c1"># font name</span>
                <span class="n">flags_decomposer</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">]),</span>  <span class="c1"># readable font flags</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span>  <span class="c1"># font size</span>
                <span class="n">s</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>  <span class="c1"># font color</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>  <span class="c1"># simple print of text</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">font_properties</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the PDF page and the script output:</p>
</div>
</div>
<a class="reference internal image-reference" href="_images/img-pdftext.jpg"><img alt="_images/img-pdftext.jpg" src="_images/img-pdftext.jpg" style="width: 1536.8000000000002px; height: 900.0px;" /></a>
<hr class="docutils" />
</section>
<section id="recipestext-i">
<span id="id15"></span><h2>如何插入文本<a class="headerlink" href="#recipestext-i" title="此标题的永久链接">#</a></h2>
<p>How to Insert Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>PyMuPDF 提供了在新建或现有 PDF 页面上插入文本的方法，并具备以下功能：</p>
<ul>
<li><p>选择字体，包括内置字体和可用的外部字体文件</p></li>
<li><p>选择文本特性，如加粗、斜体、字体大小、字体颜色等</p></li>
<li><p>以多种方式定位文本：</p>
<blockquote>
<div><ul class="simple">
<li><p>以简单的行导向方式，从特定点开始输出文本，</p></li>
<li><p>或者将文本适应到指定矩形框内，并可选择文本对齐方式，</p></li>
<li><p>选择文本是否叠加在现有内容的前景中，</p></li>
<li><p>所有文本都可以进行任意“变形”（morphing），即通过 <a class="reference internal" href="matrix.html#matrix"><span class="std std-ref">Matrix</span></a> 修改外观，以实现缩放、倾斜、镜像等效果，</p></li>
<li><p>独立于变形之外，还可以将文本按 90 度的整数倍旋转。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>以上功能由三个基本的 <a class="reference internal" href="page.html#page"><span class="std std-ref">Page</span></a> 或 <a class="reference internal" href="shape.html#shape"><span class="std std-ref">Shape</span></a> 方法提供：</p>
<ul>
<li><p><a class="reference internal" href="page.html#Page.insert_font" title="Page.insert_font"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_font()</span></code></a> —— 为页面安装一个字体，以便后续引用。其结果可通过 <a class="reference internal" href="document.html#Document.get_page_fonts" title="Document.get_page_fonts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Document.get_page_fonts()</span></code></a> 查看。该字体可以是：</p>
<blockquote>
<div><ul class="simple">
<li><p>来自外部字体文件，</p></li>
<li><p>通过 <a class="reference internal" href="font.html#font"><span class="std std-ref">Font</span></a> 提供（使用 <a class="reference internal" href="font.html#Font.buffer" title="Font.buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Font.buffer</span></code></a>），</p></li>
<li><p>已经存在于 <strong>当前或其他</strong> PDF 文件中，</p></li>
<li><p>或者是 <strong>内置</strong> 字体。</p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="page.html#Page.insert_text" title="Page.insert_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_text()</span></code></a> —— 写入若干行文本。该方法在内部调用 <a class="reference internal" href="shape.html#Shape.insert_text" title="Shape.insert_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Shape.insert_text()</span></code></a>。</p></li>
<li><p><a class="reference internal" href="page.html#Page.insert_textbox" title="Page.insert_textbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_textbox()</span></code></a> —— 将文本适应于指定的矩形框。可以选择文本对齐方式（左对齐、右对齐、居中、两端对齐），并控制文本是否能完全适应框内。该方法在内部调用 <a class="reference internal" href="shape.html#Shape.insert_textbox" title="Shape.insert_textbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Shape.insert_textbox()</span></code></a>。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>以上两种文本插入方法会自动安装所需的字体（如必要）。</p>
</div>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>PyMuPDF provides ways to insert text on new or existing PDF pages with the following features:</p>
<ul>
<li><p>choose the font, including built-in fonts and fonts that are available as files</p></li>
<li><p>choose text characteristics like bold, italic, font size, font color, etc.</p></li>
<li><p>position the text in multiple ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>either as simple line-oriented output starting at a certain point,</p></li>
<li><p>or fitting text in a box provided as a rectangle, in which case text alignment choices are also available,</p></li>
<li><p>choose whether text should be put in foreground (overlay existing content),</p></li>
<li><p>all text can be arbitrarily “morphed”, i.e. its appearance can be changed via a <a class="reference internal" href="matrix.html#matrix"><span class="std std-ref">Matrix</span></a>, to achieve effects like scaling, shearing or mirroring,</p></li>
<li><p>independently from morphing and in addition to that, text can be rotated by integer multiples of 90 degrees.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>All of the above is provided by three basic <a class="reference internal" href="page.html#page"><span class="std std-ref">Page</span></a>, resp. <a class="reference internal" href="shape.html#shape"><span class="std std-ref">Shape</span></a> methods:</p>
<ul>
<li><p><a class="reference internal" href="page.html#Page.insert_font" title="Page.insert_font"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_font()</span></code></a> – install a font for the page for later reference. The result is reflected in the output of <a class="reference internal" href="document.html#Document.get_page_fonts" title="Document.get_page_fonts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Document.get_page_fonts()</span></code></a>. The font can be:</p>
<blockquote>
<div><ul class="simple">
<li><p>provided as a file,</p></li>
<li><p>via <a class="reference internal" href="font.html#font"><span class="std std-ref">Font</span></a> (then use <a class="reference internal" href="font.html#Font.buffer" title="Font.buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Font.buffer</span></code></a>)</p></li>
<li><p>already present somewhere in <strong>this or another</strong> PDF, or</p></li>
<li><p>be a <strong>built-in</strong> font.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="page.html#Page.insert_text" title="Page.insert_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_text()</span></code></a> – write some lines of text. Internally, this uses <a class="reference internal" href="shape.html#Shape.insert_text" title="Shape.insert_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Shape.insert_text()</span></code></a>.</p></li>
<li><p><a class="reference internal" href="page.html#Page.insert_textbox" title="Page.insert_textbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_textbox()</span></code></a> – fit text in a given rectangle. Here you can choose text alignment features (left, right, centered, justified) and you keep control as to whether text actually fits. Internally, this uses <a class="reference internal" href="shape.html#Shape.insert_textbox" title="Shape.insert_textbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Shape.insert_textbox()</span></code></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Both text insertion methods automatically install the font as necessary.</p>
</div>
</div>
</div>
<section id="recipestext-i-a">
<span id="id16"></span><h3>如何编写文本行<a class="headerlink" href="#recipestext-i-a" title="此标题的永久链接">#</a></h3>
<p>How to Write Text Lines</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p>在页面上输出一些文本行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># 新建或打开一个 PDF</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>  <span class="c1"># 新建或获取现有页面（如 doc[n]）</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>  <span class="c1"># 第一行文本的起始点</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Some text,</span><span class="se">\n</span><span class="s2">spread across</span><span class="se">\n</span><span class="s2">several lines.&quot;</span>
<span class="c1"># 也可以使用列表格式：</span>
<span class="c1"># text = [&quot;Some text&quot;, &quot;spread across&quot;, &quot;several lines.&quot;]</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>  <span class="c1"># 第一字符的左下角坐标</span>
                    <span class="n">text</span><span class="p">,</span>  <span class="c1"># 文本内容（支持 &#39;\n&#39; 换行）</span>
                    <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;helv&quot;</span><span class="p">,</span>  <span class="c1"># 默认字体</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>  <span class="c1"># 默认字体大小</span>
                    <span class="n">rotate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># 旋转角度（可选：90, 180, 270）</span>
                    <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> 行文本已插入至页面 </span><span class="si">%i</span><span class="s2">。&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>

<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;text.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>在此方法中，<strong>仅会控制文本行数</strong>，确保其不会超出页面高度。多余的行不会被写入，方法返回实际写入的行数。计算过程中，行高由 <a class="reference internal" href="glossary.html#fontsize" title="fontsize"><code class="xref py py-data docutils literal notranslate"><span class="pre">fontsize</span></code></a> 计算，并在页面底部预留 36 点（0.5 英寸）的边距。</p>
<p><strong>行宽不会被检查</strong>，超出部分将不可见。</p>
<p>然而，对于内置字体，可以在插入前计算文本的行宽，请参考 <a class="reference internal" href="functions.html#get_text_length" title="get_text_length"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_text_length()</span></code></a> 方法。</p>
<p>以下是另一个示例，该示例使用四种不同的旋转角度插入 4 段文本，并展示如何选择正确的插入点以获得期望的排版效果:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="c1"># 文本内容，每个包含 3 行</span>
<span class="n">text1</span> <span class="o">=</span> <span class="s2">&quot;rotate=0</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot;rotate=90</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text3</span> <span class="o">=</span> <span class="s2">&quot;rotate=-90</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text4</span> <span class="o">=</span> <span class="s2">&quot;rotate=180</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 红色点的颜色</span>
<span class="c1"># 插入点，距页面角落 25 像素</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span>
<span class="c1"># 创建 Shape 进行绘制</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">new_shape</span><span class="p">()</span>

<span class="c1"># 绘制插入点（红色填充的圆点）</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

<span class="c1"># 插入文本</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">text1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">text3</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="n">text4</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>

<span class="c1"># 提交绘制内容</span>
<span class="n">shape</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>最终结果如下：</p>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p>Output some text lines on a page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># new or existing PDF</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>  <span class="c1"># new or existing page via doc[n]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>  <span class="c1"># start point of 1st line</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Some text,</span><span class="se">\n</span><span class="s2">spread across</span><span class="se">\n</span><span class="s2">several lines.&quot;</span>
<span class="c1"># the same result is achievable by</span>
<span class="c1"># text = [&quot;Some text&quot;, &quot;spread across&quot;, &quot;several lines.&quot;]</span>

<span class="n">rc</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>  <span class="c1"># bottom-left of 1st char</span>
                    <span class="n">text</span><span class="p">,</span>  <span class="c1"># the text (honors &#39;\n&#39;)</span>
                    <span class="n">fontname</span> <span class="o">=</span> <span class="s2">&quot;helv&quot;</span><span class="p">,</span>  <span class="c1"># the default font</span>
                    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>  <span class="c1"># the default font size</span>
                    <span class="n">rotate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># also available: 90, 180, 270</span>
                    <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> lines printed on page </span><span class="si">%i</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>

<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;text.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this method, only the <strong>number of lines</strong> will be controlled to not go beyond page height. Surplus lines will not be written and the number of actual lines will be returned. The calculation uses a line height calculated from the <a class="reference internal" href="glossary.html#fontsize" title="fontsize"><code class="xref py py-data docutils literal notranslate"><span class="pre">fontsize</span></code></a> and 36 points (0.5 inches) as bottom margin.</p>
<p>Line <strong>width is ignored</strong>. The surplus part of a line will simply be invisible.</p>
<p>However, for built-in fonts there are ways to calculate the line width beforehand - see <a class="reference internal" href="functions.html#get_text_length" title="get_text_length"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_text_length()</span></code></a>.</p>
<p>Here is another example. It inserts 4 text strings using the four different rotation options, and thereby explains, how the text insertion point must be chosen to achieve the desired result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="c1"># the text strings, each having 3 lines</span>
<span class="n">text1</span> <span class="o">=</span> <span class="s2">&quot;rotate=0</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot;rotate=90</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text3</span> <span class="o">=</span> <span class="s2">&quot;rotate=-90</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">text4</span> <span class="o">=</span> <span class="s2">&quot;rotate=180</span><span class="se">\n</span><span class="s2">Line 2</span><span class="se">\n</span><span class="s2">Line 3&quot;</span>
<span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># the color for the red dots</span>
<span class="c1"># the insertion points, each with a 25 pix distance from the corners</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span>
<span class="c1"># create a Shape to draw on</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">new_shape</span><span class="p">()</span>

<span class="c1"># draw the insertion points as red, filled dots</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

<span class="c1"># insert the text strings</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">text1</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">text3</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
<span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="n">text4</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>

<span class="c1"># store our work to the page</span>
<span class="n">shape</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the result:</p>
</div>
</div>
<a class="reference internal image-reference" href="_images/img-inserttext.jpg"><img alt="_images/img-inserttext.jpg" src="_images/img-inserttext.jpg" style="width: 221.76000000000002px; height: 260.7px;" /></a>
<hr class="docutils" />
</section>
<section id="recipestext-i-b">
<span id="id17"></span><h3>如何填充文本框<a class="headerlink" href="#recipestext-i-b" title="此标题的永久链接">#</a></h3>
<p>How to Fill a Text Box</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<p>这个脚本填充了 4 个不同的矩形区域，每次选择不同的旋转角度值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>  <span class="c1"># 新建或打开一个 PDF</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>  <span class="c1"># 新页面，或者选择 doc[n]</span>

<span class="c1"># 在此区域写入文本</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>

<span class="c1"># 将该区域分成 4 个等大小的子矩形</span>
<span class="n">CELLS</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">make_table</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 0.&quot;</span>  <span class="c1"># 这些文本将被写入</span>
<span class="n">t2</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 90.&quot;</span>
<span class="n">t3</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 180.&quot;</span>
<span class="n">t4</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 270.&quot;</span>
<span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">]</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]</span>  <span class="c1"># 一些颜色</span>
<span class="n">gold</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;gold&quot;</span><span class="p">]</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">我们使用 Shape 对象（类似画布）输出文本，并展示其周围的矩形。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">new_shape</span><span class="p">()</span>  <span class="c1"># 创建 Shape</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="n">shape</span><span class="o">.</span><span class="n">draw_rect</span><span class="p">(</span><span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># 绘制矩形</span>
    <span class="n">shape</span><span class="o">.</span><span class="n">insert_textbox</span><span class="p">(</span>
        <span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;hebo&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span> <span class="o">*</span> <span class="n">i</span>
    <span class="p">)</span>

<span class="n">shape</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">gold</span><span class="p">)</span>

<span class="n">shape</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># 将所有内容写入页面</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>上述代码使用了默认值：字体大小 11 和文本对齐方式为 “left”。运行结果如下所示：</p>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<p>This script fills 4 different rectangles with text, each time choosing a different rotation value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>  <span class="c1"># new or existing PDF</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>  <span class="c1"># new page, or choose doc[n]</span>

<span class="c1"># write in this overall area</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>

<span class="c1"># partition the area in 4 equal sub-rectangles</span>
<span class="n">CELLS</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">make_table</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 0.&quot;</span>  <span class="c1"># these texts we will written</span>
<span class="n">t2</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 90.&quot;</span>
<span class="n">t3</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 180.&quot;</span>
<span class="n">t4</span> <span class="o">=</span> <span class="s2">&quot;text with rotate = 270.&quot;</span>
<span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">]</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]</span>  <span class="c1"># some colors</span>
<span class="n">gold</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;gold&quot;</span><span class="p">]</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">pdfcolor</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We use a Shape object (something like a canvas) to output the text and</span>
<span class="sd">the rectangles surrounding it for demonstration.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">new_shape</span><span class="p">()</span>  <span class="c1"># create Shape</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="n">shape</span><span class="o">.</span><span class="n">draw_rect</span><span class="p">(</span><span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># draw rectangle</span>
    <span class="n">shape</span><span class="o">.</span><span class="n">insert_textbox</span><span class="p">(</span>
        <span class="n">CELLS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;hebo&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span> <span class="o">*</span> <span class="n">i</span>
    <span class="p">)</span>

<span class="n">shape</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">gold</span><span class="p">)</span>

<span class="n">shape</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># write all stuff to the page</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Some default values were used above: font size 11 and text alignment “left”. The result will look like this:</p>
</div>
</div>
<a class="reference internal image-reference" href="_images/img-rotate.png"><img alt="_images/img-rotate.png" src="_images/img-rotate.png" style="width: 322.5px; height: 83.5px;" /></a>
<hr class="docutils" />
</section>
<section id="html">
<span id="recipestext-i-c"></span><h3>如何用 HTML 文本填充文本框<a class="headerlink" href="#html" title="此标题的永久链接">#</a></h3>
<p>How to Fill a Box with HTML Text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p>方法 <a class="reference internal" href="page.html#Page.insert_htmlbox" title="Page.insert_htmlbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_htmlbox()</span></code></a> 提供了一种 <strong>更强大的</strong> 插入文本的方式。</p>
<p>与简单的纯文本不同，这个方法接受 HTML 源代码，HTML 源不仅可以包含 HTML 标签，还可以包含样式指令来影响字体、字体加粗（bold）、斜体（italic）、颜色等属性。</p>
<p>此外，还可以混合使用多种字体和语言，输出 HTML 表格，甚至插入图片和 URI 链接。</p>
<p>为了提供更多的样式灵活性，还可以提供额外的 CSS 源。</p>
<p>该方法基于 <a class="reference internal" href="story-class.html#story"><span class="std std-ref">Story</span></a> 类。因此，像天城文、尼泊尔语、泰米尔语等复杂的书写系统都得到支持，并且能够正确书写，得益于使用了 HarfBuzz 库，它提供了所谓的 <strong>“文本形状”</strong> 特性。</p>
<p>任何需要的字体，如果用户提供的字体不包含某些字形，会自动从 Google 的 NOTO 字体库中拉取作为后备。</p>
<p>以下是一个展示此功能的小示例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="n">rect</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: #f00;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: #0f0;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="s2">&quot;* {font-family: sans-serif;font-size:14px;}&quot;</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>请注意，”css” 参数被用来全局选择默认的 “sans-serif” 字体和字体大小 14。</p>
<p>运行结果如下所示：</p>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p>Method <a class="reference internal" href="page.html#Page.insert_htmlbox" title="Page.insert_htmlbox"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Page.insert_htmlbox()</span></code></a> offers a <strong>much more powerful</strong> way to insert text in a rectangle.</p>
<p>Instead of simple, plain text, this method accepts HTML source, which may not only contain HTML tags but also styling instructions to influence things like font, font weight (bold) and style (italic), color and much more.</p>
<p>It is also possible to mix multiple fonts and languages, to output HTML tables and to insert images and URI links.</p>
<p>For even more styling flexibility, an additional CSS source may also be given.</p>
<p>The method is based on the <a class="reference internal" href="story-class.html#story"><span class="std std-ref">Story</span></a> class. Therefore, complex script systems like Devanagari, Nepali, Tamil and many are supported and written correctly thanks to using the HarfBuzz library - which provides this so-called <strong>“text shaping”</strong> feature.</p>
<p>Any required fonts to output characters are automatically pulled in from the Google NOTO font library - as a fallback (when the – optionally supplied – user font(s) do not contain some glyphs).</p>
<p>As a small glimpse into the features offered here, we will output the following HTML-enriched text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>


<span class="n">rect</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: #f00;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: #0f0;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="s2">&quot;* {font-family: sans-serif;font-size:14px;}&quot;</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Please note how the “css” parameter is used to globally select the default “sans-serif” font and a font size of 14.</p>
<p>The result will look like this:</p>
</div>
</div>
<img alt="_images/img-htmlbox1.png" src="_images/img-htmlbox1.png" />
<section id="id18">
<h4>如何输出 HTML 表格和图像<a class="headerlink" href="#id18" title="此标题的永久链接">#</a></h4>
<p>How to output HTML tables and images</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p>这里是另一个使用此方法输出表格的示例。这次，我们将所有的样式包含在HTML源代码中。还请注意，如何在表格单元格内包含图片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">filedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;style&gt;</span>
<span class="s2">body {</span>
<span class="s2">    font-family: sans-serif;</span>
<span class="s2">}</span>

<span class="s2">td,</span>
<span class="s2">th {</span>
<span class="s2">    border: 1px solid blue;</span>
<span class="s2">    border-right: none;</span>
<span class="s2">    border-bottom: none;</span>
<span class="s2">    padding: 5px;</span>
<span class="s2">    text-align: center;</span>
<span class="s2">}</span>

<span class="s2">table {</span>
<span class="s2">    border-right: 1px solid blue;</span>
<span class="s2">    border-bottom: 1px solid blue;</span>
<span class="s2">    border-spacing: 0;</span>
<span class="s2">}</span>
<span class="s2">&lt;/style&gt;</span>

<span class="s2">&lt;body&gt;</span>
<span class="s2">&lt;p&gt;&lt;b&gt;Some Colors&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">&lt;table&gt;</span>
<span class="s2">    &lt;tr&gt;</span>
<span class="s2">    &lt;th&gt;Lime&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Lemon&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Image&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Mauve&lt;/th&gt;</span>
<span class="s2">    &lt;/tr&gt;</span>
<span class="s2">    &lt;tr&gt;</span>
<span class="s2">    &lt;td&gt;Green&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Yellow&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;&lt;img src=&quot;img-cake.png&quot; width=50&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Between&lt;br&gt;Gray and Purple&lt;/td&gt;</span>
<span class="s2">    &lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span> <span class="o">+</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># 我们必须指定一个归档，因为有图片</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>

<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>结果将如下所示：</p>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p>Here is another example that outputs a table with this method. This time, we are including all the styling in the HTML source itself. Please also note, how it works to include an image - even within a table cell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">filedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>


<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;style&gt;</span>
<span class="s2">body {</span>
<span class="s2">    font-family: sans-serif;</span>
<span class="s2">}</span>

<span class="s2">td,</span>
<span class="s2">th {</span>
<span class="s2">    border: 1px solid blue;</span>
<span class="s2">    border-right: none;</span>
<span class="s2">    border-bottom: none;</span>
<span class="s2">    padding: 5px;</span>
<span class="s2">    text-align: center;</span>
<span class="s2">}</span>

<span class="s2">table {</span>
<span class="s2">    border-right: 1px solid blue;</span>
<span class="s2">    border-bottom: 1px solid blue;</span>
<span class="s2">    border-spacing: 0;</span>
<span class="s2">}</span>
<span class="s2">&lt;/style&gt;</span>

<span class="s2">&lt;body&gt;</span>
<span class="s2">&lt;p&gt;&lt;b&gt;Some Colors&lt;/b&gt;&lt;/p&gt;</span>
<span class="s2">&lt;table&gt;</span>
<span class="s2">    &lt;tr&gt;</span>
<span class="s2">    &lt;th&gt;Lime&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Lemon&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Image&lt;/th&gt;</span>
<span class="s2">    &lt;th&gt;Mauve&lt;/th&gt;</span>
<span class="s2">    &lt;/tr&gt;</span>
<span class="s2">    &lt;tr&gt;</span>
<span class="s2">    &lt;td&gt;Green&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Yellow&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;&lt;img src=&quot;img-cake.png&quot; width=50&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Between&lt;br&gt;Gray and Purple&lt;/td&gt;</span>
<span class="s2">    &lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span> <span class="o">+</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># we must specify an Archive because of the image</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>

<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The result will look like this:</p>
</div>
</div>
<img alt="_images/img-htmlbox2.png" src="_images/img-htmlbox2.png" />
</section>
<section id="id19">
<h4>如何输出世界语言<a class="headerlink" href="#id19" title="此标题的永久链接">#</a></h4>
<p>How to Output Languages of the World</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--15-input--1" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--1">中文</label><div class="tab-content docutils container">
<p>我们的第三个示例将演示自动多语言支持。它包括针对复杂脚本系统（如梵文和从右到左的语言）的自动 <strong>文本整形</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="n">greetings</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Hello, World!&quot;</span><span class="p">,</span>  <span class="c1"># english</span>
    <span class="s2">&quot;Hallo, Welt!&quot;</span><span class="p">,</span>  <span class="c1"># german</span>
    <span class="s2">&quot;سلام دنیا!&quot;</span><span class="p">,</span>  <span class="c1"># persian</span>
    <span class="s2">&quot;வணக்கம், உலகம்!&quot;</span><span class="p">,</span>  <span class="c1"># tamil</span>
    <span class="s2">&quot;สวัสดีชาวโลก!&quot;</span><span class="p">,</span>  <span class="c1"># thai</span>
    <span class="s2">&quot;Привіт Світ!&quot;</span><span class="p">,</span>  <span class="c1"># ucranian</span>
    <span class="s2">&quot;שלום עולם!&quot;</span><span class="p">,</span>  <span class="c1"># hebrew</span>
    <span class="s2">&quot;ওহে বিশ্ব!&quot;</span><span class="p">,</span>  <span class="c1"># bengali</span>
    <span class="s2">&quot;你好世界！&quot;</span><span class="p">,</span>  <span class="c1"># chinese</span>
    <span class="s2">&quot;こんにちは世界！&quot;</span><span class="p">,</span>  <span class="c1"># japanese</span>
    <span class="s2">&quot;안녕하세요, 월드!&quot;</span><span class="p">,</span>  <span class="c1"># korean</span>
    <span class="s2">&quot;नमस्कार, विश्व !&quot;</span><span class="p">,</span>  <span class="c1"># sanskrit</span>
    <span class="s2">&quot;हैलो वर्ल्ड!&quot;</span><span class="p">,</span>  <span class="c1"># hindi</span>
<span class="p">)</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">rect</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="c1"># 将问候语合并为一个文本字符串</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; ... &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">greetings</span><span class="p">])</span>

<span class="c1"># 上面的输出很简单：</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>这是输出:</p>
</div>
<input class="tab-input" id="tab-set--15-input--2" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--2">英文</label><div class="tab-content docutils container">
<p>Our third example will demonstrate the automatic multi-language support. It includes automatic <strong>text shaping</strong> for complex scripting systems like Devanagari and right-to-left languages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="n">greetings</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Hello, World!&quot;</span><span class="p">,</span>  <span class="c1"># english</span>
    <span class="s2">&quot;Hallo, Welt!&quot;</span><span class="p">,</span>  <span class="c1"># german</span>
    <span class="s2">&quot;سلام دنیا!&quot;</span><span class="p">,</span>  <span class="c1"># persian</span>
    <span class="s2">&quot;வணக்கம், உலகம்!&quot;</span><span class="p">,</span>  <span class="c1"># tamil</span>
    <span class="s2">&quot;สวัสดีชาวโลก!&quot;</span><span class="p">,</span>  <span class="c1"># thai</span>
    <span class="s2">&quot;Привіт Світ!&quot;</span><span class="p">,</span>  <span class="c1"># ucranian</span>
    <span class="s2">&quot;שלום עולם!&quot;</span><span class="p">,</span>  <span class="c1"># hebrew</span>
    <span class="s2">&quot;ওহে বিশ্ব!&quot;</span><span class="p">,</span>  <span class="c1"># bengali</span>
    <span class="s2">&quot;你好世界！&quot;</span><span class="p">,</span>  <span class="c1"># chinese</span>
    <span class="s2">&quot;こんにちは世界！&quot;</span><span class="p">,</span>  <span class="c1"># japanese</span>
    <span class="s2">&quot;안녕하세요, 월드!&quot;</span><span class="p">,</span>  <span class="c1"># korean</span>
    <span class="s2">&quot;नमस्कार, विश्व !&quot;</span><span class="p">,</span>  <span class="c1"># sanskrit</span>
    <span class="s2">&quot;हैलो वर्ल्ड!&quot;</span><span class="p">,</span>  <span class="c1"># hindi</span>
<span class="p">)</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="n">rect</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="c1"># join greetings into one text string</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; ... &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">greetings</span><span class="p">])</span>

<span class="c1"># the output of the above is simple:</span>
<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>And this is the output:</p>
</div>
</div>
<img alt="_images/img-htmlbox3.png" src="_images/img-htmlbox3.png" />
</section>
<section id="id20">
<h4>如何指定自己的字体<a class="headerlink" href="#id20" title="此标题的永久链接">#</a></h4>
<p>How to Specify your Own Fonts</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--16-input--1" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--1">中文</label><div class="tab-content docutils container">
<p>在CSS语法中定义您的字体文件，使用 <code class="docutils literal notranslate"><span class="pre">&#64;font-face</span></code> 语句。每个字体的每种组合（如粗体或斜体）都需要单独的 <code class="docutils literal notranslate"><span class="pre">&#64;font-face</span></code> 定义。以下示例使用了著名的MS Comic Sans字体的四种变体：常规、粗体、斜体和粗斜体。</p>
<p>由于这四个字体文件位于系统的 <code class="docutils literal notranslate"><span class="pre">C:/Windows/Fonts</span></code> 文件夹中，因此该方法需要一个 <a class="reference internal" href="archive-class.html#archive"><span class="std std-ref">Archive</span></a> 定义，用来指向该文件夹:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">如何使用自己的字体与方法 Page.insert_htmlbox()。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># 示例文本</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: red;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: green;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">我们需要一个Archive对象来显示字体文件的位置。</span>
<span class="sd">我们打算使用字体系列“MS Comic Sans”。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">(</span><span class="s2">&quot;C:/Windows/Fonts&quot;</span><span class="p">)</span>

<span class="c1"># 这些语句定义了常规、粗体、斜体和粗斜体文本使用的字体文件。</span>
<span class="c1"># 我们为所有4个字体文件分配了一个任意的通用字体系列。</span>
<span class="c1"># Story算法会根据需要选择正确的文件。</span>
<span class="c1"># 我们要求在整个文本中使用“comic”。</span>
<span class="n">css</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">@font-face {font-family: comic; src: url(comic.ttf);}</span>
<span class="s2">@font-face {font-family: comic; src: url(comicbd.ttf);font-weight: bold;}</span>
<span class="s2">@font-face {font-family: comic; src: url(comicz.ttf);font-weight: bold;font-style: italic;}</span>
<span class="s2">@font-face {font-family: comic; src: url(comici.ttf);font-style: italic;}</span>
<span class="s2">* {font-family: comic;}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>  <span class="c1"># 创建小页面</span>

<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">subset_fonts</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 创建子集字体以减小文件大小</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--16-input--2" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--2">英文</label><div class="tab-content docutils container">
<p>Define your font files in CSS syntax using the <code class="xref any docutils literal notranslate"><span class="pre">&#64;font-face</span></code> statement. You need a separate <code class="xref any docutils literal notranslate"><span class="pre">&#64;font-face</span></code> for every combination of font weight and font style (e.g. bold or italic) you want to be supported. The following example uses the famous MS Comic Sans font in its four variants regular, bold, italic and bold-italic.</p>
<p>As these four font files are located in the system’s folder <code class="xref any docutils literal notranslate"><span class="pre">C:/Windows/Fonts</span></code> the method needs an <a class="reference internal" href="archive-class.html#archive"><span class="std std-ref">Archive</span></a> definition that points to that folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How to use your own fonts with method Page.insert_htmlbox().</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># Example text</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: red;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: green;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We need an Archive object to show where font files are located.</span>
<span class="sd">We intend to use the font family &quot;MS Comic Sans&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">(</span><span class="s2">&quot;C:/Windows/Fonts&quot;</span><span class="p">)</span>

<span class="c1"># These statements define which font file to use for regular, bold,</span>
<span class="c1"># italic and bold-italic text.</span>
<span class="c1"># We assign an arbitrary common font-family for all 4 font files.</span>
<span class="c1"># The Story algorithm will select the right file as required.</span>
<span class="c1"># We request to use &quot;comic&quot; throughout the text.</span>
<span class="n">css</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">@font-face {font-family: comic; src: url(comic.ttf);}</span>
<span class="s2">@font-face {font-family: comic; src: url(comicbd.ttf);font-weight: bold;}</span>
<span class="s2">@font-face {font-family: comic; src: url(comicz.ttf);font-weight: bold;font-style: italic;}</span>
<span class="s2">@font-face {font-family: comic; src: url(comici.ttf);font-style: italic;}</span>
<span class="s2">* {font-family: comic;}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>  <span class="c1"># make small page</span>

<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">subset_fonts</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># build subset fonts to reduce file size</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<img alt="_images/img-htmlbox4.png" src="_images/img-htmlbox4.png" />
</section>
<section id="id21">
<h4>如何请求文本对齐<a class="headerlink" href="#id21" title="此标题的永久链接">#</a></h4>
<p>How to Request Text Alignment</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--17-input--1" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--1">中文</label><div class="tab-content docutils container">
<p>此示例结合了多个要求：</p>
<ul class="simple">
<li><p>将文本逆时针旋转90度。</p></li>
<li><p>使用来自 <a class="reference external" href="https://pypi.org/project/pymupdf-fonts/">pymupdf-fonts</a> 包的字体。你会发现，在这种情况下，相应的CSS定义要容易得多。</p></li>
<li><p>使用“justify”选项对齐文本。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">如何使用pymupdf字体与方法 Page.insert_htmlbox()。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># 示例文本</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: red;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: green;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">这类似于字体文件支持。然而，我们可以使用一个便捷函数来创建所需的CSS定义。</span>
<span class="sd">我们仍然需要一个Archive来查找字体二进制文件。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">()</span>

<span class="c1"># 我们请求在整个文本中使用“myfont”字体。</span>
<span class="n">css</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">css_for_pymupdf_font</span><span class="p">(</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myfont&quot;</span><span class="p">)</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;* {font-family: myfont;text-align: justify;}&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">subset_fonts</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--17-input--2" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--2">英文</label><div class="tab-content docutils container">
<p>This example combines multiple requirements:</p>
<ul class="simple">
<li><p>Rotate the text by 90 degrees anti-clockwise.</p></li>
<li><p>Use a font from package <a class="reference external" href="https://pypi.org/project/pymupdf-fonts/">pymupdf-fonts</a>. You will see that the respective CSS definitions are a lot easier in this case.</p></li>
<li><p>Align the text with the “justify” option.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How to use a pymupdf font with method Page.insert_htmlbox().</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>

<span class="c1"># Example text</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Lorem ipsum dolor sit amet, consectetur adipisici elit, sed</span>
<span class="s2">    eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad</span>
<span class="s2">    minim veniam, quis nostrud exercitation &lt;b&gt;ullamco &lt;i&gt;laboris&lt;/i&gt;&lt;/b&gt;</span>
<span class="s2">    nisi ut aliquid ex ea commodi consequat. Quis aute iure</span>
<span class="s2">    &lt;span style=&quot;color: red;&quot;&gt;reprehenderit&lt;/span&gt;</span>
<span class="s2">    in &lt;span style=&quot;color: green;font-weight:bold;&quot;&gt;voluptate&lt;/span&gt; velit</span>
<span class="s2">    esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat</span>
<span class="s2">    cupiditat non proident, sunt in culpa qui</span>
<span class="s2">    &lt;a href=&quot;https://www.artifex.com&quot;&gt;officia&lt;/a&gt; deserunt mollit anim id</span>
<span class="s2">    est laborum.&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is similar to font file support. However, we can use a convenience</span>
<span class="sd">function for creating required CSS definitions.</span>
<span class="sd">We still need an Archive for finding the font binaries.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Archive</span><span class="p">()</span>

<span class="c1"># We request to use &quot;myfont&quot; throughout the text.</span>
<span class="n">css</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">css_for_pymupdf_font</span><span class="p">(</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myfont&quot;</span><span class="p">)</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;* {font-family: myfont;text-align: justify;}&quot;</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">page</span><span class="o">.</span><span class="n">insert_htmlbox</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">subset_fonts</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">ez_save</span><span class="p">(</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<img alt="_images/img-htmlbox5.png" src="_images/img-htmlbox5.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>
<section id="recipestext-j">
<span id="id23"></span><h2>如何提取带颜色的文本<a class="headerlink" href="#recipestext-j" title="此标题的永久链接">#</a></h2>
<p>How to Extract Text with Color</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--18-input--1" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--1">中文</label><div class="tab-content docutils container">
<p>遍历您的文本块并找到此信息所需的文本跨度。</p>
</div>
<input class="tab-input" id="tab-set--18-input--2" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--2">英文</label><div class="tab-content docutils container">
<p>Iterate through your text blocks and find the spans of text you need for this information.</p>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
    <span class="n">text_blocks</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">pymupdf</span><span class="o">.</span><span class="n">TEXTFLAGS_TEXT</span><span class="p">)[</span><span class="s2">&quot;blocks&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">text_blocks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;spans&quot;</span><span class="p">]:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">sRGB_to_rgb</span><span class="p">(</span><span class="n">span</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">, Color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="feedbackLink"><a id="feedbackLinkBottom" target=_blank>您对此页面有任何反馈吗？</b></a></div><hr class="docutils" />
<script>

   var url_string = window.location.href;
   var a = document.getElementById('feedbackLinkBottom');
   a.setAttribute("href", "https://artifex.com/contributor/feedback.php?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link&url="+url_string);

</script>

<p style="color:#999" id="footerDisclaimer">本软件按原样提供，不作任何明示或暗示担保。本软件根据许可分发，除非根据该许可条款明确授权，否则不得复制、修改或分发。请参阅 <a href="https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link">artifex.com</a> 上的许可信息，或联系 Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States 了解更多信息。</p>



<script>

   let docLanguage = document.getElementsByTagName('html')[0].getAttribute('lang');

   function getHeaderAndFooterTranslation(str) {
       if (docLanguage == "ja") {
           if (str == "Do you have any feedback on this page?") {
               return "このページに関するご意見はありますか？";
           } else if (str == "Find <b>#pymupdf</b> on <b>Discord</b>") {
               return "<b>Discord</b>の <b>#pymupdf</b> を見つける";
           } else if (str == "This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.") {

               return "このソフトウェアは無保証で提供されており、明示または黙示を問わず、いかなる保証もありません。このソフトウェアはライセンスの下で配布され、ライセンスの条件に明示的に許可されている場合を除き、コピー、変更、または配布してはなりません。ライセンシング情報については、<a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a>でライセンス情報を参照するか、アメリカ合衆国カリフォルニア州サンフランシスコのArtifex Software Inc. までお問い合わせください。"

           }
       }

       return str;
   }

   document.getElementById("findOnDiscord").innerHTML = getHeaderAndFooterTranslation("Find <b>#pymupdf</b> on <b>Discord</b>");
   document.getElementById("feedbackLinkTop").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("feedbackLinkBottom").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("footerDisclaimer").innerHTML = getHeaderAndFooterTranslation("This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.");


   // more translation for admonition-title as the in-built translation isn't great, needs: 注釈 -> 注
   if (docLanguage == "ja") {
       const collection = document.getElementsByClassName("admonition-title");
       for (var i=0;i<collection.length;i++) {
           collection[i].innerHTML = "注";
       }
   }


</script><p class="footer-version">This documentation covers all versions up to 1.25.4.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="recipes-images.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">图片</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="how-to-open-a-file.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">打开文件</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015-2025, Artifex
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 19. 3月 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">文本</a><ul>
<li><a class="reference internal" href="#recipestext-a">如何提取所有文档文本</a></li>
<li><a class="reference internal" href="#markdown">如何将文本提取为 Markdown</a></li>
<li><a class="reference internal" href="#recipestext-a1">如何从页面中提取键值对</a></li>
<li><a class="reference internal" href="#recipestext-b">如何从矩形内提取文本</a></li>
<li><a class="reference internal" href="#recipestext-c">如何按自然阅读顺序提取文本</a></li>
<li><a class="reference internal" href="#recipestext-d">如何从文档中 提取表格内容</a></li>
<li><a class="reference internal" href="#recipestext-e">如何标记提取的文本</a></li>
<li><a class="reference internal" href="#recipestext-f">如何标记搜索到的文本</a></li>
<li><a class="reference internal" href="#recipestext-g">如何标记非水平文本</a></li>
<li><a class="reference internal" href="#recipestext-h">如何分析字体特征</a></li>
<li><a class="reference internal" href="#recipestext-i">如何插入文本</a><ul>
<li><a class="reference internal" href="#recipestext-i-a">如何编写文本行</a></li>
<li><a class="reference internal" href="#recipestext-i-b">如何填充文本框</a></li>
<li><a class="reference internal" href="#html">如何用 HTML 文本填充文本框</a><ul>
<li><a class="reference internal" href="#id18">如何输出 HTML 表格和图像</a></li>
<li><a class="reference internal" href="#id19">如何输出世界语言</a></li>
<li><a class="reference internal" href="#id20">如何指定自己的字体</a></li>
<li><a class="reference internal" href="#id21">如何请求文本对齐</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#recipestext-j">如何提取带颜色的文本</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/tabs.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>