<!doctype html>
<html class="no-js" lang="zh-CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="Artifex" name="author" />
<meta content="PyMuPDF 是一个高性能 Python 库，用于 PDF（及其他）文档的数据提取、分析、转换和操作。" name="description" />
<meta content="PDF Text Extraction, PDF Image Extraction, PDF Conversion, PDF Tables, PDF Splitting, PDF Creation, Pyodide, PyScript" name="keywords" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZTN4VTL9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JZTN4VTL9M');
    </script>
    <link rel="author" title="关于此文档" href="about.html" /><link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="多进程" href="recipes-multiprocessing.html" /><link rel="prev" title="故事" href="recipes-stories.html" />

    <link rel="shortcut icon" href="_static/PyMuPDF.ico"/><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>日记 - PyMuPDF 1.25.4 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">PyMuPDF 1.25.4 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/sidebar-logo-dark.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/sidebar-logo-light.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PyMuPDF 1.25.4 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">关于/About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">功能比较</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#about-performance">性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#about-license">许可和版权</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf4llm/index.html">PyMuPDF4LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf-pro.html">PyMuPDF Pro</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户指南/User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="the-basics.html">基础用法</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag.html">PyMuPDF、LLM 和 RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">资源</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">教程/How to Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="how-to-open-a-file.html">打开文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-text.html">文本</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-images.html">图片</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-annotations.html">注释</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-drawing-and-graphics.html">绘图和图形</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-stories.html">故事</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">日记</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-multiprocessing.html">多进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-ocr.html">OCR - 光学字符识别</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-optional-content.html">可选内容支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-low-level-interfaces.html">低级接口</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-common-issues-and-their-solutions.html">常见问题及其解决方案</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考/API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="module.html">命令行界面</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="classes.html">类</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="annot.html">Annot</a></li>
<li class="toctree-l2"><a class="reference internal" href="archive-class.html">Archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="colorspace.html">Colorspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="displaylist.html">DisplayList</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="document-writer-class.html">DocumentWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="font.html">Font</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity.html">Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="irect.html">IRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="link.html">Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="linkdest.html">linkDest</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrix.html">Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="outline.html">Outline</a></li>
<li class="toctree-l2"><a class="reference internal" href="page.html">Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="pixmap.html">Pixmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="point.html">Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="quad.html">Quad</a></li>
<li class="toctree-l2"><a class="reference internal" href="rect.html">Rect</a></li>
<li class="toctree-l2"><a class="reference internal" href="shape.html">Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="story-class.html">Story</a></li>
<li class="toctree-l2"><a class="reference internal" href="textpage.html">TextPage</a></li>
<li class="toctree-l2"><a class="reference internal" href="textwriter.html">TextWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="widget.html">Widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml-class.html">Xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="algebra.html">几何对象的运算符代数</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="lowlevel.html">低级函数和类</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="functions.html">函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="device.html">设备</a></li>
<li class="toctree-l2"><a class="reference internal" href="coop_low.html">协同工作: DisplayList 和 TextPage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="vars.html">常量和枚举</a></li>
<li class="toctree-l1"><a class="reference internal" href="colors.html">颜色数据库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他/Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="app1.html">附录 1：文本提取详细信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="app2.html">附录 2：嵌入式文件的注意事项</a></li>
<li class="toctree-l1"><a class="reference internal" href="app3.html">附录 3：各类技术信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="app4.html">附录 4：性能比较方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">更新日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="znames.html">已废弃名称</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div style="display:flex;justify-content:space-between;align-items: center;">
    <form class="sidebar-search-container top" method="get" action="search.html" role="search" style="width:75%">
      <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
</div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-top:20px;">
    <div class="discordLink" style="display:flex;align-items:center;margin-top: -5px;">
        <a href="https://discord.gg/TSpYGBW4eq" id="findOnDiscord" target=_blank>Find <b>#pymupdf</b> on <b>Discord</b></a>
        <a href="https://discord.gg/TSpYGBW4eq" target=_blank>
            <div style="width:30px;height:30px;margin-left:5px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
                    <defs>
                        <style>.discordLogoFill{fill:#5865f2;}</style>
                    </defs>
                    <g id="Discord_Logo" data-name="Discord Logo">
                        <path class="discordLogoFill" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </g>
                </svg>
            </div>
        </a>
    </div>

</div><section id="recipesjournalling">
<span id="id1"></span><h1>日记<a class="headerlink" href="#recipesjournalling" title="此标题的永久链接">#</a></h1>
<p>Journalling</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>从版本 1.19.0 开始，MuPDF 支持在更新 PDF 文档时进行日志记录（journalling）。</p>
<p>日志记录是一种日志机制，允许 <strong>撤销</strong> 或 <strong>重新应用</strong> 对 PDF 所做的更改。类似于现代数据库系统中的 LUW（”逻辑工作单元”），可以将一组更新组合成一个“操作”。在 MuPDF 的日志记录中，操作扮演着 LUW 的角色。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>与数据库系统中的 LUW 实现不同，MuPDF 的日志记录是 <strong>按文档级别</strong> 进行的。它不支持跨多个 PDF 文件的同时更新：如果需要此类功能，用户需要自行实现逻辑。</p>
</div>
<ul class="simple">
<li><p>日志记录必须通过文档方法 <em>启用</em>。日志记录可用于现有文档或新文档。日志记录 <strong>只能在关闭文件时禁用</strong>。</p></li>
<li><p>一旦启用，每个更改都必须发生在一个 <em>操作</em> 中——否则会引发异常。操作通过文档方法启动和停止。在这两个调用之间发生的更新构成一个 LUW，因此可以整体回滚或重新应用，或者用 MuPDF 术语来说就是“撤销”或“重做”。</p></li>
<li><p>可以随时查询日志记录状态：是否启用日志记录，已记录了多少个操作，是否可以进行“撤销”或“重做”，当前日志位置等。</p></li>
<li><p>日志可以 <strong>保存到</strong> 或 <strong>从</strong> 文件中加载。这些是文档方法。</p></li>
<li><p>加载日志文件时，会检查与文档的兼容性，并在成功后自动启用日志记录。</p></li>
<li><p>对于 <strong>现有的</strong> 被记录日志的 PDF，提供了一种特殊的新保存方法：<a class="reference internal" href="document.html#Document.save_snapshot" title="Document.save_snapshot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Document.save_snapshot()</span></code></a>。此方法执行一种特殊的增量保存，包括所有已经记录的更新。如果同时保存其日志（紧接着文档快照之后），则文档和日志将同步，以后可以一起使用以撤销或重做操作，或继续记录的更新——就像没有中断一样。</p></li>
<li><p>快照 PDF 是一个有效的 PDF，在各方面都是可用的。然而，如果在没有使用其日志文件的情况下更改文档，则会发生去同步，日志变得不可用。</p></li>
<li><p>快照文件的结构类似于增量更新。尽管如此，内部日志记录逻辑要求 <strong>必须保存到一个新文件</strong>。因此，用户应开发一种文件命名约定，以支持原始 PDF 和其快照集之间的可识别关系，例如 <code class="xref any docutils literal notranslate"><span class="pre">original.pdf</span></code> 和它的快照集，像 <code class="xref any docutils literal notranslate"><span class="pre">original-snap1.pdf</span></code> / <code class="xref any docutils literal notranslate"><span class="pre">original-snap1.log</span></code>，<code class="xref any docutils literal notranslate"><span class="pre">original-snap2.pdf</span></code> / <code class="xref any docutils literal notranslate"><span class="pre">original-snap2.log</span></code> 等。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>Starting with version 1.19.0, journalling is possible when updating PDF documents.</p>
<p>Journalling is a logging mechanism which permits either <strong>reverting</strong> or <strong>re-applying</strong> changes to a PDF. Similar to LUWs “Logical Units of Work” in modern database systems, one can group a set of updates into an “operation”. In MuPDF journalling, an operation plays the role of a LUW.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>In contrast to LUW implementations found in database systems, MuPDF journalling happens on a <strong>per document level</strong>. There is no support for simultaneous updates across multiple PDFs: one would have to establish one’s own logic here.</p>
</div>
<ul class="simple">
<li><p>Journalling must be <em>enabled</em> via a document method. Journalling is possible for existing or new documents. Journalling <strong>can be disabled only</strong> by closing the file.</p></li>
<li><p>Once enabled, every change must happen inside an <em>operation</em> – otherwise an exception is raised. An operation is started and stopped via document methods. Updates happening between these two calls form an LUW and can thus collectively be rolled back or re-applied, or, in MuPDF terminology “undone” resp. “redone”.</p></li>
<li><p>At any point, the journalling status can be queried: whether journalling is active, how many operations have been recorded, whether “undo” or “redo” is possible, the current position inside the journal, etc.</p></li>
<li><p>The journal can be <strong>saved to</strong> or <strong>loaded from</strong> a file. These are document methods.</p></li>
<li><p>When loading a journal file, compatibility with the document is checked and journalling is automatically enabled upon success.</p></li>
<li><p>For an <strong>existing</strong> PDF being journalled, a special new save method is available: <a class="reference internal" href="document.html#Document.save_snapshot" title="Document.save_snapshot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Document.save_snapshot()</span></code></a>. This performs a special incremental save that includes all journalled updates so far. If its journal is saved at the same time (immediately after the document snapshot), then document and journal are in sync and can later on be used together to undo or redo operations or to continue journalled updates – just as if there had been no interruption.</p></li>
<li><p>The snapshot PDF is a valid PDF in every aspect and fully usable. If the document is however changed in any way without using its journal file, then a desynchronization will take place and the journal is rendered unusable.</p></li>
<li><p>Snapshot files are structured like incremental updates. Nevertheless, the internal journalling logic requires, that saving <strong>must happen to a new file</strong>. So the user should develop a file naming convention to support recognizable relationships between an original PDF, like <code class="xref any docutils literal notranslate"><span class="pre">original.pdf</span></code> and its snapshot sets, like <code class="xref any docutils literal notranslate"><span class="pre">original-snap1.pdf</span></code> / <code class="xref any docutils literal notranslate"><span class="pre">original-snap1.log</span></code>, <code class="xref any docutils literal notranslate"><span class="pre">original-snap2.pdf</span></code> / <code class="xref any docutils literal notranslate"><span class="pre">original-snap2.log</span></code>, etc.</p></li>
</ul>
</div>
</div>
<section id="id2">
<h2>示例会话 1<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h2>
<p>Example Session 1</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>描述：</p>
<ul class="simple">
<li><p>创建一个新的PDF并启用日志记录。然后添加一个页面和一些文本行，每个操作作为单独的日志条目。</p></li>
<li><p>在日志中导航，撤销和重做这些更新，并显示状态和文件结果：</p></li>
</ul>
<p>示例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_enable</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 尝试没有操作的更新：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="go">mupdf: No journalling operation started</span>
<span class="go">... 省略的行</span>
<span class="go">RuntimeError: No journalling operation started</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;Line 1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="s2">&quot;Line 2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span> <span class="s2">&quot;Line 3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 显示在日志中的位置</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 记录了4个操作 - 当前处于底部</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 我们可以做什么？</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 目前只能撤销。打印页面内容：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>
<span class="go">Line 3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 撤销最后一次插入：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_undo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 再次显示合并状态：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span> <span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(3, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: True}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 我们现在的位置是倒数第二</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 最后的文本插入已被撤销</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 但我们也可以重做/向前移动：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_redo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 我们的合并状态：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span> <span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>
<span class="go">Line 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Line 3 又出现了！</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>Description:</p>
<ul>
<li><p>Make a new PDF and enable journalling. Then add a page and some text lines – each as a separate operation.</p></li>
<li><p>Navigate within the journal, undoing and redoing these updates and displaying status and file results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pymupdf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">=</span><span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_enable</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># try update without an operation:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="go">mupdf: No journalling operation started</span>
<span class="go">... omitted lines</span>
<span class="go">RuntimeError: No journalling operation started</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;Line 1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span> <span class="s2">&quot;Line 2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;op4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">140</span><span class="p">),</span> <span class="s2">&quot;Line 3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># show position in journal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 4 operations recorded - positioned at bottom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># what can we do?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># currently only undos are possible. Print page content:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>
<span class="go">Line 3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># undo last insert:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_undo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># show combined status again:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(3, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: True}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># our position is now second to last</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># last text insertion was reverted</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but we can redo / move forward as well:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_redo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># our combined status:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
<span class="go">Line 1</span>
<span class="go">Line 2</span>
<span class="go">Line 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># line 3 has appeared again!</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</section>
<section id="id3">
<h2>示例会话 2<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h2>
<p>Example Session 2</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>描述：</p>
<ul>
<li><p>与之前的例子类似，但在撤销了一些操作后，我们现在添加了一个不同的更新操作。这将导致：</p>
<blockquote>
<div><ul class="simple">
<li><p>被撤销的日志条目被永久移除</p></li>
<li><p>新的更新操作将成为新的最后一条日志条目。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>示例：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_enable</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;插入页面&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;insert-</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;text line </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># 合并状态信息：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span> <span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(6, 6)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># 撤销最后三次操作</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">doc</span><span class="o">.</span><span class="n">journal_undo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span> <span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(3, 6)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: True}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># 现在做一个不同的更新：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;绘制一条线&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">draw_line</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span>
<span class="go">Point(300.0, 150.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span> <span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># 这已经改变了日志：</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 之前的最后三次文本插入操作被移除，</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 现在我们只有4个操作：绘制线条是新的最后一条操作</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>Description:</p>
<ul>
<li><p>Similar to previous, but after undoing some operations, we now add a different update. This will cause:</p>
<blockquote>
<div><ul class="simple">
<li><p>permanent removal of the undone journal entries</p></li>
<li><p>the new update operation will become the new last entry.</p></li>
</ul>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">=</span><span class="n">pymupdf</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_enable</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;Page insert&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="go">        doc.journal_start_op(&quot;insert-%i&quot; % i)</span>
<span class="go">        page.insert_text((100, 100 + 20*i), &quot;text line %i&quot; %i)</span>
<span class="go">        doc.journal_stop_op()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># combined status info:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(6, 6)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># revert last three operations</span>
<span class="go">        doc.journal_undo()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(3, 6)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: True}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># now do a different update:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_start_op</span><span class="p">(</span><span class="s2">&quot;Draw some line&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span><span class="o">.</span><span class="n">draw_line</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">150</span><span class="p">))</span>
<span class="go">Point(300.0, 150.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_stop_op</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">journal_position</span><span class="p">();</span><span class="n">doc</span><span class="o">.</span><span class="n">journal_can_do</span><span class="p">()</span>
<span class="go">(4, 4)</span>
<span class="go">{&#39;undo&#39;: True, &#39;redo&#39;: False}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># this has changed the journal:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># previous last 3 text line operations were removed, and</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># we have only 4 operations: drawing the line is the new last one</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="feedbackLink"><a id="feedbackLinkBottom" target=_blank>您对此页面有任何反馈吗？</b></a></div><hr class="docutils" />
<script>

   var url_string = window.location.href;
   var a = document.getElementById('feedbackLinkBottom');
   a.setAttribute("href", "https://artifex.com/contributor/feedback.php?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link&url="+url_string);

</script>

<p style="color:#999" id="footerDisclaimer">本软件按原样提供，不作任何明示或暗示担保。本软件根据许可分发，除非根据该许可条款明确授权，否则不得复制、修改或分发。请参阅 <a href="https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link">artifex.com</a> 上的许可信息，或联系 Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States 了解更多信息。</p>



<script>

   let docLanguage = document.getElementsByTagName('html')[0].getAttribute('lang');

   function getHeaderAndFooterTranslation(str) {
       if (docLanguage == "ja") {
           if (str == "Do you have any feedback on this page?") {
               return "このページに関するご意見はありますか？";
           } else if (str == "Find <b>#pymupdf</b> on <b>Discord</b>") {
               return "<b>Discord</b>の <b>#pymupdf</b> を見つける";
           } else if (str == "This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.") {

               return "このソフトウェアは無保証で提供されており、明示または黙示を問わず、いかなる保証もありません。このソフトウェアはライセンスの下で配布され、ライセンスの条件に明示的に許可されている場合を除き、コピー、変更、または配布してはなりません。ライセンシング情報については、<a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a>でライセンス情報を参照するか、アメリカ合衆国カリフォルニア州サンフランシスコのArtifex Software Inc. までお問い合わせください。"

           }
       }

       return str;
   }

   document.getElementById("findOnDiscord").innerHTML = getHeaderAndFooterTranslation("Find <b>#pymupdf</b> on <b>Discord</b>");
   document.getElementById("feedbackLinkTop").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("feedbackLinkBottom").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("footerDisclaimer").innerHTML = getHeaderAndFooterTranslation("This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.");


   // more translation for admonition-title as the in-built translation isn't great, needs: 注釈 -> 注
   if (docLanguage == "ja") {
       const collection = document.getElementsByClassName("admonition-title");
       for (var i=0;i<collection.length;i++) {
           collection[i].innerHTML = "注";
       }
   }


</script><p class="footer-version">This documentation covers all versions up to 1.25.4.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="recipes-multiprocessing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">多进程</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="recipes-stories.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">故事</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015-2025, Artifex
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 19. 3月 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">日记</a><ul>
<li><a class="reference internal" href="#id2">示例会话 1</a></li>
<li><a class="reference internal" href="#id3">示例会话 2</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/tabs.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>